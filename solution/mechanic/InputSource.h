//
// Created by lookuut on 17.09.18.
//

#ifndef MADCARS_INPUTSOURCE_H
#define MADCARS_INPUTSOURCE_H

#include <iostream>"
#include <list>

using namespace std;

enum input_stream_type {emulation, input_stream , file_stream};

class InputSource {

private:
    list<string> test_steps;


    bool logging = false;
    input_stream_type type;
    ofstream log;

    ifstream file_stream;
public:

    InputSource(input_stream_type type, bool logging) {
        this->type = type;
        this->logging = logging;

        if (this->logging) {
            log.open ("mad-cars-input.log");
        }

        if (type == input_stream_type::file_stream) {
            file_stream.open(("mad-cars-input.log"));
        }

        test_steps.push_back("{\"type\": \"new_match\", \"params\": {\"my_lives\": 3, \"enemy_lives\": 3, \"proto_map\": {\"external_id\": 1, \"segments\": [[[300, 100], [900, 100], 10], [[300, 700], [900, 700], 10], [[300.0, 700.0], [268.641461019704, 698.3565686104821], 10], [[268.641461019704, 698.3565686104821], [237.6264927546722, 693.4442802201418], 10], [[237.6264927546722, 693.4442802201418], [207.2949016875158, 685.3169548885461], 10], [[207.2949016875158, 685.3169548885461], [177.97900707726, 674.0636372927803], 10], [[177.97900707726, 674.0636372927803], [150.00000000000006, 659.8076211353316], 10], [[150.00000000000006, 659.8076211353316], [123.66442431225809, 642.7050983124842], 10], [[123.66442431225809, 642.7050983124842], [99.26081809234262, 622.9434476432184], 10], [[99.26081809234262, 622.9434476432184], [77.0565523567818, 600.7391819076574], 10], [[77.0565523567818, 600.7391819076574], [57.29490168751579, 576.335575687742], 10], [[57.29490168751579, 576.335575687742], [40.192378864668456, 550.0000000000001], 10], [[40.192378864668456, 550.0000000000001], [25.936362707219757, 522.0209929227401], 10], [[25.936362707219757, 522.0209929227401], [14.683045111453964, 492.70509831248427], 10], [[14.683045111453964, 492.70509831248427], [6.55571977985835, 462.3735072453279], 10], [[6.55571977985835, 462.3735072453279], [1.643431389518014, 431.35853898029615], 10], [[1.643431389518014, 431.35853898029615], [0.0, 400.00000000000006], 10], [[0.0, 400.00000000000006], [1.643431389517957, 368.6414610197041], 10], [[1.643431389517957, 368.6414610197041], [6.555719779858293, 337.62649275467226], 10], [[6.555719779858293, 337.62649275467226], [14.683045111453907, 307.2949016875158], 10], [[14.683045111453907, 307.2949016875158], [25.9363627072197, 277.97900707726006], 10], [[25.9363627072197, 277.97900707726006], [40.19237886466834, 250.00000000000009], 10], [[40.19237886466834, 250.00000000000009], [57.29490168751573, 223.6644243122581], 10], [[57.29490168751573, 223.6644243122581], [77.05655235678162, 199.26081809234262], 10], [[77.05655235678162, 199.26081809234262], [99.26081809234248, 177.0565523567818], 10], [[99.26081809234248, 177.0565523567818], [123.66442431225803, 157.2949016875158], 10], [[123.66442431225803, 157.2949016875158], [149.99999999999986, 140.1923788646685], 10], [[149.99999999999986, 140.1923788646685], [177.97900707725972, 125.93636270721981], 10], [[177.97900707725972, 125.93636270721981], [207.29490168751573, 114.68304511145396], 10], [[207.29490168751573, 114.68304511145396], [237.62649275467206, 106.55571977985835], 10], [[237.62649275467206, 106.55571977985835], [268.64146101970374, 101.64343138951801], 10], [[268.64146101970374, 101.64343138951801], [299.99999999999994, 100.0], 10], [[900.0, 700.0], [931.3585389802961, 698.356568610482], 10], [[931.3585389802961, 698.356568610482], [962.3735072453278, 693.4442802201416], 10], [[962.3735072453278, 693.4442802201416], [992.7050983124842, 685.316954888546], 10], [[992.7050983124842, 685.316954888546], [1022.0209929227401, 674.0636372927802], 10], [[1022.0209929227401, 674.0636372927802], [1050.0, 659.8076211353316], 10], [[1050.0, 659.8076211353316], [1076.335575687742, 642.7050983124842], 10], [[1076.335575687742, 642.7050983124842], [1100.7391819076574, 622.9434476432183], 10], [[1100.7391819076574, 622.9434476432183], [1122.9434476432182, 600.7391819076574], 10], [[1122.9434476432182, 600.7391819076574], [1142.7050983124843, 576.335575687742], 10], [[1142.7050983124843, 576.335575687742], [1159.8076211353316, 550.0], 10], [[1159.8076211353316, 550.0], [1174.0636372927802, 522.0209929227401], 10], [[1174.0636372927802, 522.0209929227401], [1185.316954888546, 492.7050983124842], 10], [[1185.316954888546, 492.7050983124842], [1193.4442802201415, 462.3735072453278], 10], [[1193.4442802201415, 462.3735072453278], [1198.356568610482, 431.3585389802961], 10], [[1198.356568610482, 431.3585389802961], [1200.0, 400.0], 10], [[1200.0, 400.0], [1198.356568610482, 368.64146101970397], 10], [[1198.356568610482, 368.64146101970397], [1193.4442802201418, 337.62649275467226], 10], [[1193.4442802201418, 337.62649275467226], [1185.316954888546, 307.2949016875158], 10], [[1185.316954888546, 307.2949016875158], [1174.0636372927802, 277.97900707725995], 10], [[1174.0636372927802, 277.97900707725995], [1159.8076211353316, 250.00000000000006], 10], [[1159.8076211353316, 250.00000000000006], [1142.7050983124843, 223.66442431225806], 10], [[1142.7050983124843, 223.66442431225806], [1122.9434476432184, 199.2608180923426], 10], [[1122.9434476432184, 199.2608180923426], [1100.7391819076574, 177.05655235678176], 10], [[1100.7391819076574, 177.05655235678176], [1076.335575687742, 157.29490168751576], 10], [[1076.335575687742, 157.29490168751576], [1050.0, 140.19237886466846], 10], [[1050.0, 140.19237886466846], [1022.0209929227401, 125.93636270721976], 10], [[1022.0209929227401, 125.93636270721976], [992.7050983124842, 114.68304511145396], 10], [[992.7050983124842, 114.68304511145396], [962.3735072453279, 106.55571977985835], 10], [[962.3735072453279, 106.55571977985835], [931.3585389802961, 101.64343138951801], 10], [[931.3585389802961, 101.64343138951801], [900.0, 100.0], 10]]}, \"proto_car\": {\"car_body_poly\": [[0, 6], [8, 62], [136, 62], [153, 32], [153, 5], [110, 0], [23, 0]], \"rear_wheel_radius\": 13, \"front_wheel_radius\": 13, \"button_poly\": [[137, 59], [137.87002218584863, 59.49301257198088], [151.67437420131327, 35.132391368219736], [150.80435201546464, 34.63937879623886]], \"external_id\": 2, \"car_body_mass\": 700, \"car_body_friction\": 0.9, \"car_body_elasticity\": 0.5, \"max_speed\": 45, \"max_angular_speed\": 2, \"torque\": 35000000, \"drive\": 3, \"rear_wheel_mass\": 60, \"rear_wheel_position\": [38, -5], \"rear_wheel_friction\": 0.9, \"rear_wheel_elasticity\": 0.8, \"rear_wheel_joint\": [0, 0], \"rear_wheel_groove_offset\": 5, \"rear_wheel_damp_position\": [38, 30], \"rear_wheel_damp_length\": 35, \"rear_wheel_damp_stiffness\": 100000.0, \"rear_wheel_damp_damping\": 6000.0, \"front_wheel_mass\": 60, \"front_wheel_position\": [125, -5], \"front_wheel_friction\": 1, \"front_wheel_elasticity\": 0.8, \"front_wheel_joint\": [0, 0], \"front_wheel_groove_offset\": 5, \"front_wheel_damp_position\": [125, 30], \"front_wheel_damp_length\": 35, \"front_wheel_damp_stiffness\": 100000.0, \"front_wheel_damp_damping\": 6000.0}}}");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.0, 300.0], 0.0, 1, [338.0, 295.0, 0.0], [425.0, 295.0, 0.0]], \"enemy_car\": [[900.0, 300.0], 0.0, -1, [862.0, 295.0, 0.0], [775.0, 295.0, 0.0]], \"deadline_position\": 10.0}}\n");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.0, 300.0], 0.0, 1, [338.0, 295.0, 0.0], [425.0, 295.0, 0.0]], \"enemy_car\": [[900.0, 300.0], 0.0, -1, [862.0, 295.0, 0.0], [775.0, 295.0, 0.0]], \"deadline_position\": 10.0}}\n");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.0, 299.8208], -1.5282209470981877e-19, 1, [338.0, 294.8208, -1.5282254545876365e-19], [425.0, 294.8208, -1.5282209470981877e-19]], \"enemy_car\": [[900.0, 299.8208], 1.5282209470981877e-19, -1, [862.0, 294.8208, 1.5282254545876365e-19], [775.0, 294.8208, 1.5282209470981877e-19]], \"deadline_position\": 10.0}}\n");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.0, 299.46286536896235], -3.5594144865961874e-19, 1, [338.0, 294.46286536896235, -3.559430784640554e-19], [425.0, 294.46286536896235, -3.559414486596187e-19]], \"enemy_car\": [[900.0, 299.46286536896235], 3.5594144865961874e-19, -1, [862.0, 294.46286536896235, 3.559430784640554e-19], [775.0, 294.46286536896235, 3.559414486596187e-19]], \"deadline_position\": 10.0}}\n");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.0, 298.926660267321], -5.162757088295037e-19, 1, [338.0, 293.926660267321, -5.162754855400268e-19], [425.0, 293.926660267321, -5.162757088295036e-19]], \"enemy_car\": [[900.0, 298.926660267321], 5.162757088295037e-19, -1, [862.0, 293.926660267321, 5.162754855400268e-19], [775.0, 293.926660267321, 5.162757088295036e-19]], \"deadline_position\": 10.0}}\n");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.0, 298.2126476501201], -6.377980072260034e-19, 1, [338.0, 293.2126476501201, -6.377963181883698e-19], [425.0, 293.2126476501201, -6.377980072260033e-19]], \"enemy_car\": [[900.0, 298.2126476501201], 6.377980072260034e-19, -1, [862.0, 293.2126476501201, 6.377963181883698e-19], [775.0, 293.2126476501201, 6.377980072260033e-19]], \"deadline_position\": 10.0}}\n");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.0, 297.3212892701444], -7.266084885293656e-19, 1, [338.0, 292.3212892701444, -7.266052026455345e-19], [425.0, 292.3212892701444, -7.266084885293655e-19]], \"enemy_car\": [[900.0, 297.3212892701444], 7.266084885293656e-19, -1, [862.0, 292.3212892701444, 7.266052026455345e-19], [775.0, 292.3212892701444, 7.266084885293655e-19]], \"deadline_position\": 10.0}}\n");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.0, 296.2530456810411], -7.911171923465141e-19, 1, [338.0, 291.2530456810411, -7.911115487311029e-19], [425.0, 291.2530456810411, -7.91117192346514e-19]], \"enemy_car\": [[900.0, 296.2530456810411], 7.911171923465141e-19, -1, [862.0, 291.2530456810411, 7.911115487311029e-19], [775.0, 291.2530456810411, 7.91117192346514e-19]], \"deadline_position\": 10.0}}\n");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.0, 295.0083762404342], -8.368485159393408e-19, 1, [338.0, 290.00837624043425, -8.368400854238315e-19], [425.0, 290.00837624043425, -8.368485159393407e-19]], \"enemy_car\": [[900.0, 295.0083762404342], 8.368485159393408e-19, -1, [862.0, 290.00837624043425, 8.368400854238315e-19], [775.0, 290.00837624043425, 8.368485159393407e-19]], \"deadline_position\": 10.0}}\n");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.0, 293.5877391130304], -5.332062832837803e-19, 1, [338.0, 288.58773911303047, -5.331998427025853e-19], [425.0, 288.58773911303047, -5.332062832837803e-19]], \"enemy_car\": [[900.0, 293.5877391130304], 5.332062832837803e-19, -1, [862.0, 288.58773911303047, 5.331998427025853e-19], [775.0, 288.58773911303047, 5.332062832837803e-19]], \"deadline_position\": 10.0}}");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.0, 291.99159127371706], -3.0844883216314123e-19, 1, [338.0, 286.9915912737171, -3.0844289838223898e-19], [425.0, 286.9915912737171, -3.0844883216314123e-19]], \"enemy_car\": [[900.0, 291.99159127371706], 3.0844883216314123e-19, -1, [862.0, 286.9915912737171, 3.0844289838223898e-19], [775.0, 286.9915912737171, 3.0844883216314123e-19]], \"deadline_position\": 10.0}}\n");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.0, 290.2203885106519], -1.4988019691892863e-19, 1, [338.0, 285.22038851065196, -1.4987517517799088e-19], [425.0, 285.22038851065196, -1.498801969189286e-19]], \"enemy_car\": [[900.0, 290.2203885106519], 1.4988019691892863e-19, -1, [862.0, 285.22038851065196, 1.4987517517799088e-19], [775.0, 285.22038851065196, 1.498801969189286e-19]], \"deadline_position\": 10.0}}\n");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.06431264248437, 288.08148882395886], 0.0025164036322546275, 1, [338.07643436451224, 283.19516895490835, -0.7174835963677454], [425.0763092042223, 283.3735344650454, -0.7174835963677454]], \"enemy_car\": [[900.0, 288.27458542834506], 4.9262669469601573e-20, -1, [862.0, 283.2745854283451, 4.925835320566603e-20], [775.0, 283.2745854283451, 4.926266946960155e-20]], \"deadline_position\": 10.0}}\n");
        test_steps.push_back("{\"type\": \"tick\", \"params\": {\"my_car\": [[300.1644994192635, 285.6635157158947], 0.006400854919519644, 1, [338.1948835344757, 280.9364923959832, -1.4335991450804804], [425.1940465136448, 281.4263500529376, -1.4335991450804804]], \"enemy_car\": [[900.0, 286.1546354507329], -6.160340241495525e-19, -1, [862.0, 281.15463545073294, -6.160579352393953e-19], [775.0, 281.15463545073294, -6.160340241495526e-19]], \"deadline_position\": 10.0}}");
        test_steps.push_back("");
    }

    ~InputSource() {

        if (this->logging) {
            log.close();
        }

        if (type == input_stream_type::file_stream) {
            file_stream.close();
        }
    }

    inline string get_tick() {
        string input_string = "";
        if (type == input_stream_type::input_stream) {
            getline(cin, input_string);
        } else if (type == input_stream_type::emulation) {
            input_string = test_steps.front();
            test_steps.pop_front();
        } else if (type == input_stream_type::file_stream) {
            getline (file_stream, input_string);
        }

        if (this->logging) {
            log << input_string << endl;
        }

        return input_string;
    }
};
#endif //MADCARS_INPUTSOURCE_H
